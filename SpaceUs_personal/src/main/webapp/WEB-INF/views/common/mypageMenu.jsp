<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>
<%-- 한글 인코딩 처리 --%>
<fmt:requestEncoding value="utf-8" />
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
 
<script>
(function(t,a,l,k,j,s){
s=a.createElement('script');s.async=1;s.src="https://cdn.talkjs.com/talk.js";a.head.appendChild(s)
;k=t.Promise;t.Talk={v:3,ready:{then:function(f){if(k)return new k(function(r,e){l.push([f,r,e])});l
.push([f])},catch:function(){return k&&new k()},c:l}};})(window,document,[]);
</script>

<input type="hidden" id="nick" value="${member.nickName}" />
<input type="hidden" id="mail" value="${member.memberEmail}" />
<input type="hidden" id="result" value="${member.nickName =='관리자'?'SpaceUs':'회원'}" />
<script>

Talk.ready.then(function() {
    var me = new Talk.User({
        id: $("#nick").val(),
        name: $("#nick").val(),
        email: $("#mail").val(),
        photoUrl: "https://localhost:9090/spaceus/",
        welcomeMessage: "대화를 시작하세요 :-)"
    });
    window.talkSession = new Talk.Session({
        appId: "t9ROalbH",
        me: me
    });
    var other = new Talk.User({
        id: "관리자",
        name: "SpaceUs",
        email: "admin@spaceus.com",
        photoUrl: "https://localhost:9090/spaceus/",
        welcomeMessage: "무엇을 도와드릴까요❓"
    });

    var conversation = talkSession.getOrCreateConversation(Talk.oneOnOneId(me, other))
    conversation.setParticipant(me);
    conversation.setParticipant(other);


    if($("#nick").val() == '관리자'){
    	 var inbox = talkSession.createInbox({selected: conversation});
 	    inbox.mount(document.getElementById("talkjs-container"));
    }
    else{
    var conversation = window.talkSession.getOrCreateConversation(Talk.oneOnOneId(me, other));
    conversation.setParticipant(me);
    conversation.setParticipant(other);
    var popup = window.talkSession.createPopup(conversation, { keepOpen: false });
    popup.mount({ show: false });

    var button = document.getElementById("btn-getInTouch");
    button.addEventListener("click", function(event) {
        event.preventDefault();
        popup.show();
    });
    }
});
var other = new Talk.User({
	 id: $("#nick").val(),
    name: $("#result").val(),
    email: $("#mail").val(),
    photoUrl: "http://localhost:9090/spaceus/",
    welcomeMessage: "무엇을 도와드릴까요?"
});

var conversation = talkSession.getOrCreateConversation(Talk.oneOnOneId(me, other));
conversation.setParticipant(me);
conversation.setParticipant(other);

var conversation = talkSession.getOrCreateConversation(user);

conversation.setAttributes({
   subject: "Hair Wax 5 Gallons"
}); 
</script>
<div class="skin-default-dark fixed-layout">
    <div id="main-wrapper">
        <!-- 마이페이지 헤더 -->
        <header class="topbar">
            <nav class="navbar top-navbar navbar-expand-md navbar-dark">
                <div class="navbar-header">
                    <a style="color:black" class="navbar-brand" href="${pageContext.request.contextPath }">SpaceUs</a>
                </div>
                <div class="navbar-collapse">
                    <ul class="navbar-nav my-lg-0">
                       <li class="nav-item dropdown">
	                    <form:form action="${ pageContext.request.contextPath }/member/memberLogout.do">
				      	 	 <button class="btn m-r-30" type="submit">로그아웃</button>
				      	 </form:form>
                       </li>
                   </ul> 
               </div>
            </nav>
        </header>
        
        <!-- 왼쪽 목록들 -->
        <sec:authorize access="hasAnyRole('USER', 'HOST')">
	        <aside class="left-sidebar">
	            <div class="d-flex no-block nav-text-box align-items-center">
	                <span>마이페이지</span>
	                <a class="waves-effect waves-dark ml-auto hidden-sm-down" href="javascript:void(0)"><i class="ti-menu"></i></a>
	                <a class="nav-toggler waves-effect waves-dark ml-auto hidden-sm-up" href="javascript:void(0)"><i class="ti-menu ti-close"></i></a>
	            </div>
	            <!-- Sidebar scroll-->
	            <div class="scroll-sidebar">
	                <!-- Sidebar navigation-->
	                <nav class="sidebar-nav">
	 					<ul id="sidebarnav">
	                        <li> <a class="waves-effect waves-dark" aria-expanded="false" href="${pageContext.request.contextPath }/member/memberProfile.do"><i class="fa fa-user"></i><span class="hide-menu">회원 정보</span></a></li>
	                        <li> <a class="waves-effect waves-dark" aria-expanded="false" href="${pageContext.request.contextPath }/member/wishList.do"><i class="fa fa-heart"></i><span class="hide-menu">위시리스트</span></a></li>
	                        <li> <a class="waves-effect waves-dark" aria-expanded="false" href="${pageContext.request.contextPath }/member/usageHistory.do"><i class="fa fa-table"></i><span class="hide-menu"></span>예약 내역</a></li>
	  						<li> <a class="waves-effect waves-dark" aria-expanded="false" href="${pageContext.request.contextPath }/member/reviewList.do"><i class="fa fa-book"></i><span class="hide-menu">리뷰 목록</span></a></li>
	                        <li> <a class="waves-effect waves-dark" aria-expanded="false" href="${pageContext.request.contextPath }/member/couponList.do"><i class="fa fa-gift"></i><span class="hide-menu"></span>쿠폰 목록</a></li>
	                        <li> <a class="waves-effect waves-dark" aria-expanded="false" href="${pageContext.request.contextPath }/member/stampEvent.do"><i class="fa fa-stamp"></i><span class="hide-menu"></span>출석 체크</a></li>
	                    </ul>
	                </nav>
	                <!-- End Sidebar navigation -->
	            </div>
	            <!-- End Sidebar scroll-->
	        </aside>
        </sec:authorize>
        <!-- 목록 끝 -->